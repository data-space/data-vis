---
title: "UNvotes"
author: "Hanh Nguyen"
date: "6/12/2017"
output: pdf_document
---

```{r setup, include=FALSE}
library(dplyr)
library(unvotes)
library(ggplot2)
```

Erik Voeten "Data and Analyses of Voting in the UN General Assembly" Routledge Handbook of International Organization, edited by Bob Reinalda (published May 27, 2013)
The package contains three datasets.
1. un_votes
2. un_roll_calls
3. un_roll_call_issues
un_roll_calls: each row is a country-vote pair
rcid = roll call id - one round of voting
Details about the datasets can be found here https://github.com/dgrtwo/unvotes or by ??unvotes

We start with the first dataset **un_votes**, which is the history of each country's vote.   
By running *unique(un_votes$vote)*, we see that the **vote** column has three values: *yes, no, & abstain*.  

A summary of the votes within each year. 
```{r}
df = merge(x=un_votes, y=un_roll_calls, by="rcid", all.x=TRUE)
head(df)
df$year <- as.numeric(format(df$date,"%Y"))
by_year = df %>%
  group_by(year) %>%
  summarize(total=n(), percent_yes = mean(vote=="yes"))
by_year

ggplot(by_year, aes(year, percent_yes)) +
  geom_line()

ggplot(by_year, aes(year, percent_yes)) +
  geom_point() +
  geom_smooth()
```

A summary of the votes within each country, which shows voting patterns among countries.

```{r}
by_country = df %>%
  group_by(country) %>%
  summarize(total=n(), percent_yes = mean(vote=="yes"))
by_country
```

Looking at countries that voted yes most and least
```{r}
arrange(by_country, percent_yes)
arrange(by_country, desc(percent_yes))
```

The country that voted least frequently, Zanzibar, had only 2 votes in the entire dataset, thus it's hard to conclude anything. We will exclude countries with fewer than 100 votes.

```{r}
by_country %>%
  arrange(percent_yes) %>%
  filter(total >= 100)
```

summarize by both year and country, constructing a dataset that shows what fraction of the time each country votes "yes" in each year.

```{r}
by_year_country = df %>%
  group_by(year, country) %>%
  summarize(total = n(),
            percent_yes = mean(vote == 1))
by_year_country

```

Create a filtered version: US_by_year
```{r}
US_by_year = by_year_country %>%
  filter(country=="United States")
ggplot(US_by_year, aes(x=year,y=percent_yes)) +
  geom_line()
```

Plotting just one country at a time is interesting, but you really want to compare trends between countries. For example, suppose you want to compare voting trends for the United States, the UK, France, and China. The %in% operator!
```{r}
countries <- c("United States", "United Kingdom",
               "France", "China")
filtered_4_countries = by_year_country %>%
  filter(country %in% countries)
ggplot(filtered_4_countries, aes(x=year,y=percent_yes,color=country)) +geom_line()
```


  
  